/*!CK:1439000426!*//*1458859481,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["kBw1g"]); }

__d("XPrivacyAudienceAlignmentLoggingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/privacy\/audience_alignment\/log\/",{client_time:{type:"Int"},event:{type:"Enum",required:true,enumType:1},product:{type:"Enum",required:true,enumType:1},shown_duration:{type:"Float"},value:{type:"Int"},source:{type:"Enum",enumType:1}});},null);
__d('AudienceAlignment',['cx','Arbiter','AsyncRequest','AudienceSelector','ComposerXStore','ContextualDialog','CSS','DialogExpansion','DOM','Event','Focus','Keys','ModalMask','PrivacyConst','Run','SelectorDeprecated','Style','XPrivacyAudienceAlignmentLoggingController','curry','tidyEvent'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=false,j,k,l,m;function n(qa,ra){qa.setContext(ra);qa.show();}function o(qa,ra){var sa=c('Style').get(ra.getContentRoot(),'margin-top');qa.setWidth(this.aaa_dialog_width);qa.show();c('Style').set(qa.getContentRoot(),'margin-top',sa);}var p='wwwtux',q='onlyme-wwwtux',r='exposed',s='public_sticky',t='friends_sticky',u='only_me_sticky',v='custom_selection',w='selector',x='holdout',y='dismissal',z='learn_more',aa='blur',ba='posted';function ca(qa,event,ra){var sa=c('XPrivacyAudienceAlignmentLoggingController').getURIBuilder().setEnum('product',qa).setEnum('event',event).setInt('client_time',Date.now());m&&sa.setFloat('shown_duration',(Date.now()-m)/1000);ra&&sa.setInt('value',ra);var ta=new (c('AsyncRequest'))().setURI(sa.getURI());ta.send();}function da(qa,ra,sa,ta,ua){if(i)return false;if(!c('DOM').contains(document.body,ra.getRoot()))return false;var va=c('ComposerXStore').get(sa,'maininput');if(va&&va.instance.getValue())return false;if(!ta)return false;var wa=null;if(ua){wa=ua.getSelectedBaseValue();}else wa=parseInt(c('SelectorDeprecated').getValue(ta),10);return wa===qa;}function ea(){var qa=c('DOM').scry(document.body,'#pagelet_timeline_recent');if(qa.length>=1){var ra=c('DOM').scry(qa[0],'li.fbTimelineComposerCapsule');if(ra.length>=1)return ra[0];}return null;}function fa(qa,ra,sa,ta){var ua;if(ta){ua=ta.getMenuElement();}else{var va=c('DOM').find(sa,'div.audienceSelector');ua=c('DOM').scry(va,'div.wrap');}if(ua.length<1)return;var wa=ea(),xa;if(ta){ta.subscribeOnce('open',function(){if(wa)c('CSS').addClass(wa,"_2wc-");c('ContextualDialog').setContext(ra,ua);ra.show();});}else xa=c('SelectorDeprecated').listen(va,'open',function(){var ab=c('DOM').scry(ua[0],'div.uiSelectorMenuWrapper');if(ab.length>0){if(wa)c('CSS').addClass(wa,"_2wc-");c('ContextualDialog').setContext(ra,ab[0]);ra.setOffsetX(12);ra.show();}else c('ModalMask').hide();c('SelectorDeprecated').unsubscribe(xa);});if(ta){ta.getPopover().subscribeOnce('hide',function(){ga(ra,ua,wa,qa);});}else var ya=c('SelectorDeprecated').listen(va,'close',function(){ga(ra,ua[0],wa,qa);c('SelectorDeprecated').unsubscribe(ya);});if(ta){c('CSS').addClass(ua,"_35mn");var za=ta.getTriggerButtonElement();c('CSS').addClass(za,"_35mn");}else c('CSS').addClass(ua[0],"_35mn");setTimeout(function(){c('ModalMask').show();c('Style').set(c('ModalMask').getNode(),'opacity','0.3');c('Style').set(c('ModalMask').getNode(),'background-color','rgb(0,0,0)');if(ta){ta.openSelectorExpanded();}else c('SelectorDeprecated').toggle(va);},20);}function ga(qa,ra,sa,ta){c('ModalMask').hide();qa.hide();c('CSS').removeClass(ra,"_35mn");if(sa)c('CSS').removeClass(sa,"_2wc-");c('Focus').set(c('DOM').find(ta.getRoot(),'textarea.input'));}function ha(qa,ra,sa){qa.unsubscribe(k);qa.hide();c('Focus').set(c('DOM').find(ra.getRoot(),'textarea.input'));l=c('Event').listen(ra.getRoot(),'submit',function(){ca(sa,ba);l&&l.remove();});c('tidyEvent')(l);}function ia(qa){var ra=ka(qa);return ra&&ra.element;}function ja(qa){var ra=ka(qa);return ra&&ra.instance&&ra.instance.getInstance().getInstance();}function ka(qa){return c('ComposerXStore').get(qa,'mainprivacywidget');}function la(qa,ra,sa,ta,ua,va){var wa=ia(qa),xa=ja(qa),ya=oa(ta),za=na(ta);if(ya===null||!za)return;ha(sa,ra,va);if(xa){xa.selectOption(ya);}else c('AudienceSelector').setAudience(ra.getRoot(),ta);n(ua,wa);ca(va,za);}function ma(qa){switch(qa){case c('PrivacyConst').BaseValue.EVERYONE:return p;case c('PrivacyConst').BaseValue.SELF:return q;default:return null;}}function na(qa){switch(qa){case c('PrivacyConst').BaseValue.EVERYONE:return s;case c('PrivacyConst').BaseValue.ALL_FRIENDS:return t;case c('PrivacyConst').BaseValue.SELF:return u;default:return null;}}function oa(qa){switch(qa){case c('PrivacyConst').BaseValue.EVERYONE:return c('PrivacyConst').PostParam.EVERYONE;case c('PrivacyConst').BaseValue.ALL_FRIENDS:return c('PrivacyConst').PostParam.FRIENDS;case c('PrivacyConst').BaseValue.SELF:return c('PrivacyConst').PostParam.ONLY_ME;default:return null;}}var pa={abort:function(){i=true;},startOnComposerFocus:function(qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib){var jb=ma(qa);if(!jb)return;var kb=c('Arbiter').subscribeOnce('composerprivacy/aborteducation',this.abort.bind(this)),lb=c('Arbiter').subscribe('composer/focus',function(){var mb=ia(ib),nb=ja(ib);if(da(qa,sa,ib,mb,nb)){m=Date.now();if(ra){ca(jb,x);}else{ca(jb,r);setTimeout(function(){ta.show();var ob=bb.parentElement;this.aaa_dialog_width=ta.getWidth()+ob.offsetWidth-490;var pb=new (c('DialogExpansion'))(ta);pb.setTargetWidth(this.aaa_dialog_width);pb._onAfterShow();c('Focus').set(ta.getRoot());},100);}}});c('Event').listen(bb,'click',c('curry')(la,ib,sa,ta,ab,ua,jb));c('Event').listen(db,'click',c('curry')(la,ib,sa,ta,cb,va,jb));c('Event').listen(eb,'click',function(){ta.subscribe('hide',function(){var mb=ia(ib),nb=ja(ib);if(nb)nb.subscribeOnce('changed',function(event,ob){ca(jb,v,ob.base_value);});if(wa)fa(sa,wa,mb,nb);});ha(ta,sa,jb);ca(jb,w);});if(fb)c('Event').listen(fb,'click',function(){var mb=ia(ib);ha(ta,sa,jb);ca(jb,y);if(xa)n(xa,mb);});k=ta.subscribe('hide',function(){var mb=ia(ib);c('Focus').set(c('DOM').find(sa.getRoot(),'textarea.input'));ca(jb,y);if(ya)n(ya,mb);});j=ta.subscribe('blur',function(){ca(jb,aa);});c('Event').listen(gb,'click',function(event){o(za,ta);ca(jb,z);});c('Event').listen(hb,'click',function(event){za.hide();});if(fb)c('Event').listen(za.getRoot(),'keydown',function(event){if(c('Event').getKeyCode(event)===c('Keys').ESC){za.hide();c('Event').kill(event);}});c('Run').onLeave(function(){c('Arbiter').unsubscribe(lb);c('Arbiter').unsubscribe(kb);});}};f.exports=pa;},null);