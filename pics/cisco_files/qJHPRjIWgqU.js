/*!CK:990608949!*//*1458859428,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["PZFej"]); }

__d('SearchBadgingDispatcher',['Arbiter','AsyncRequest','AttachmentRelatedShareConstants','NavigationMessage','Run','SearchPivotType','SubscriptionsHandler','UFIFeedbackTargets','UFIUIEvents','XSearchBadgingController'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=false,i={},j={},k,l={init:function(){if(h)return;k=new (c('SubscriptionsHandler'))();k.addSubscriptions(c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,l._cleanup.bind(this)));c('Run').onLeave(l._cleanup.bind(this));h=true;},_cleanup:function(){k&&k.release();k=null;h=false;},_onLike:function(m,n){if(!n.ft_id)return;c('UFIFeedbackTargets').getFeedbackTarget(n.ft_id,function(o){var p=o.entidentifier;if(p==null||i[p]!=null)return;i[p]=true;l._dispatch(n.target,{actor_id:o.actorid,story_id:o.entidentifier,origin:n.origin,query:n.query});});},initOnArticleClick:function(m,n){if(!h)l.init();if(k==null)return;k.addSubscriptions(c('Arbiter').subscribe(c('AttachmentRelatedShareConstants').ARTICLE_CLICK,l._onArticleClick.bind(this)));},_onArticleClick:function(m,n){var o=n.global_share_id!=null?String(n.global_share_id):null;l._dispatch(null,{global_share_id:o,story_id:n.share_id,origin:c('SearchPivotType').ARTICLE_CLICK_ACTION});},initOnComment:function(m,n){if(!h)l.init();if(k==null)return;k.addSubscriptions(c('Arbiter').subscribe('UFI/CommentAddedActive',function(o,p){var q={origin:m,query:n,ft_id:p};l._onComment(o,q);}));},_onComment:function(m,n){if(!n.ft_id)return;c('UFIFeedbackTargets').getFeedbackTarget(n.ft_id,function(o){var p=o.entidentifier;if(p==null||j[p]!=null)return;j[p]=true;l._dispatch(n.target,{actor_id:o.actorid,story_id:o.entidentifier,origin:n.origin,query:n.query});});},initOnLike:function(m,n,o){if(!h)l.init();if(k==null)return;k.addSubscriptions(c('Arbiter').subscribe(c('UFIUIEvents').ReactionButtonClicked,function(p,q){q.origin=m;q.query=n;if(o)q.target=null;l._onLike(p,q);}));},_dispatch:function(m,n,o){if(!n.origin)return true;var p=c('XSearchBadgingController').getURIBuilder().setString('origin',n.origin);if(n.story_id)p.setString('story_id',n.story_id);if(n.actor_id)p.setString('actor_id',n.actor_id);if(n.global_share_id)p.setString('global_share_id',n.global_share_id.toString());if(n.query)p.setString('query',n.query);var q=new (c('AsyncRequest'))().setURI(p.getURI());q.send();return true;}};f.exports=l;},null);