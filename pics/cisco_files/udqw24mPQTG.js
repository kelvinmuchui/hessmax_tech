/*!CK:2413530193!*//*1458859445,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["byxln"]); }

__d('PubcontentFeedChainingControllerX',['csx','cx','AggregatedLinkComposerConfig','Arbiter','AsyncRequest','AttachmentRelatedShareConstants','ContextualThing','CSS','DOM','DOMQuery','FeedAdsChainingConfig','NavigationMessage','PageLikeConstants','PubcontentFeedChainingConfig','PubcontentRelatedShareChainingConfig','PubcontentTopicChainingConfig','RelatedEventsPivotChainingConfig','Run','SearchRelatedPostsPivotChainingConfig','StoryInlinePivotChainingConfig','StoryTopicMap','SubscriptionsHandler','UFIFeedbackTargets','UFIUIEvents','XEventRelatedEventsPivotController','XFeedAdsChainingController','XPubcontentFeedChainingController','XPubcontentInlineStoryPivotChainingController','XPubcontentRelatedShareChainingController','XPubcontentRelatedVideoChainingController','XPubcontentTopicChainingController','XQuickPromotionFeedPivotController','XRelatedGamesChainingController','XSearchRelatedPostsPivotController','getOrCreateDOMID'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j='ei',k='ad_fan_page_action',l='ad_like_page_post_action',m='page_story_like_action',n='related_share_article_click',o='related_share_video_click',p='page_share_like_action',q='topic_story_like_action',r='story_click_for_pivot_action',s='story_like_pivot_action',t='event_join',u='composer_publish_action',v=null,w=false;x.init=function(y){var z=y.isLazy;'use strict';if(!v)v=new x({isLazy:z});if(!w){c('Run').onLeave(x.cleanup);c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,x.cleanup);w=true;}};x.cleanup=function(){'use strict';if(v){v.cleanup();v=null;}};function x(y){var z=y.isLazy;'use strict';this.$PubcontentFeedChainingControllerX1=c('PubcontentFeedChainingConfig');this.$PubcontentFeedChainingControllerX2=c('FeedAdsChainingConfig');this.$PubcontentFeedChainingControllerX3=c('PubcontentRelatedShareChainingConfig');this.$PubcontentFeedChainingControllerX4=c('PubcontentTopicChainingConfig');this.$PubcontentFeedChainingControllerX5=c('StoryInlinePivotChainingConfig');this.$PubcontentFeedChainingControllerX6=c('RelatedEventsPivotChainingConfig');this.$PubcontentFeedChainingControllerX7=c('SearchRelatedPostsPivotChainingConfig');this.$PubcontentFeedChainingControllerX8={};this.$PubcontentFeedChainingControllerX9=new (c('SubscriptionsHandler'))();this.$PubcontentFeedChainingControllerX9.addSubscriptions(this.$PubcontentFeedChainingControllerX10(c('PageLikeConstants').LIKED,z,this.$PubcontentFeedChainingControllerX11.bind(this)),this.$PubcontentFeedChainingControllerX10(c('UFIUIEvents').ActionLinkLike,z,this.$PubcontentFeedChainingControllerX12.bind(this)),this.$PubcontentFeedChainingControllerX10(c('UFIUIEvents').ReactionButtonClicked,z,this.$PubcontentFeedChainingControllerX12.bind(this)),this.$PubcontentFeedChainingControllerX10(c('UFIUIEvents').Comment,z,this.$PubcontentFeedChainingControllerX13.bind(this)),this.$PubcontentFeedChainingControllerX10('composer/publish',z,this.$PubcontentFeedChainingControllerX14.bind(this)),this.$PubcontentFeedChainingControllerX10('LitestandComposer/publish',z,this.$PubcontentFeedChainingControllerX14.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').ARTICLE_CLICK,z,this.$PubcontentFeedChainingControllerX15.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').VIDEO_CLICK,z,this.$PubcontentFeedChainingControllerX16.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').FBVIDEO_CLICK,z,this.$PubcontentFeedChainingControllerX17.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').GAME_CLICK,z,this.$PubcontentFeedChainingControllerX18.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').PHOTO_CLICK,z,this.$PubcontentFeedChainingControllerX19.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').EVENT_JOIN,z,this.$PubcontentFeedChainingControllerX20.bind(this)));}x.prototype.$PubcontentFeedChainingControllerX10=function(event,y,z){'use strict';var aa=y?[event,event+'.lazy']:[event];return c('Arbiter').subscribe(aa,z);};x.prototype.cleanup=function(){'use strict';this.$PubcontentFeedChainingControllerX9&&this.$PubcontentFeedChainingControllerX9.release();this.$PubcontentFeedChainingControllerX9=null;};x.getAdClientTokenIndex=function(){'use strict';return j;};x.prototype.$PubcontentFeedChainingControllerX11=function(y,z){'use strict';var aa=this.findAdClientToken(z.target);if(aa){this.$PubcontentFeedChainingControllerX21(z.target,{origin:k,actor_id:z.profile_id,client_token:aa});}else this.$PubcontentFeedChainingControllerX22(z.target,{origin:z.origin,actor_id:z.profile_id});};x.prototype.$PubcontentFeedChainingControllerX12=function(y,z){'use strict';if(!z.ft_id||!z.target)return;if(!this.$PubcontentFeedChainingControllerX23(this.findStory(z.target))||this.$PubcontentFeedChainingControllerX24(this.findStory(z.target)))return;c('UFIFeedbackTargets').getFeedbackTarget(z.ft_id,function(aa,ba){var ca=this.findAdClientToken(aa);if(ca&&ba.isshare){this.$PubcontentFeedChainingControllerX21(aa,{actor_id:ba.actorid,origin:l,ft_id:ba.entidentifier,client_token:ca});}else if(ba.isownerpage){var da=ba.isshare?p:m,ea=ba.isshare?ba.entidentifier:null;this.$PubcontentFeedChainingControllerX22(aa,{actor_id:ba.actorid,content_id:ba.entidentifier,ft_id:ea,origin:da});}else if(ba.isshare){this.$PubcontentFeedChainingControllerX22(aa,{actor_id:ba.actorid,content_id:ba.entidentifier,ft_id:ba.entidentifier,origin:p});}else{var fa=c('StoryTopicMap').getTopicsForFTID(ba.entidentifier);if(fa&&fa.length>0){this.$PubcontentFeedChainingControllerX25(aa,{ft_id:ba.entidentifier,origin:q,pivotal_topic_ids:fa});}else this.$PubcontentFeedChainingControllerX26(aa,{origin:s,ft_id:ba.entidentifier});}}.bind(this,z.target));};x.prototype.$PubcontentFeedChainingControllerX13=function(y,z){'use strict';if(!z.ft_id||!z.target)return;if(!this.$PubcontentFeedChainingControllerX23(this.findStory(z.target))||this.$PubcontentFeedChainingControllerX24(this.findStory(z.target)))return;c('UFIFeedbackTargets').getFeedbackTarget(z.ft_id,function(aa,ba){this.$PubcontentFeedChainingControllerX27(z.target,{origin:n,action_trigger:'COMMENT',ft_id:ba.entidentifier});}.bind(this,z.target));};x.prototype.$PubcontentFeedChainingControllerX26=function(y,z){'use strict';var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;var ba=c('XPubcontentInlineStoryPivotChainingController').getURIBuilder().setString('origin',z.origin);if(z.story_id)ba.setString('storyid',String(z.story_id));if(z.ft_id)ba.setString('ftid',String(z.ft_id));new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(ba.getURI()).setAllowCrossPageTransition(true).send();return true;};x.prototype.$PubcontentFeedChainingControllerX19=function(y,z){'use strict';var aa=this;aa.$PubcontentFeedChainingControllerX26(z.attachment,{origin:r,story_id:z.storyid});};x.prototype.$PubcontentFeedChainingControllerX15=function(y,z){'use strict';if(c('AggregatedLinkComposerConfig').no_chained_related_stories==='true')return;z.origin=n;var aa=this,ba=this.findStory(z.attachment),ca=c('DOMQuery').scry(c('DOMQuery').getRootElement(),'#initial_browse_result').length>0;if(ca)return;var da;if(z.is_right_click){da=0;}else da=c('AttachmentRelatedShareConstants').EVENT_DELAY;setTimeout(function(){if(ba){var ea=aa.findAttachment(ba);if(ea)z.attachment=ea;}aa.$PubcontentFeedChainingControllerX30(z.attachment,z);},da);};x.prototype.$PubcontentFeedChainingControllerX16=function(y,z){'use strict';z.origin=o;var aa=this,ba=this.findStory(z.attachment);setTimeout(function(){if(ba){var ca=aa.findAttachment(ba);if(ca)z.attachment=ca;}aa.$PubcontentFeedChainingControllerX30(z.attachment,z);},c('AttachmentRelatedShareConstants').EVENT_DELAY);};x.prototype.$PubcontentFeedChainingControllerX17=function(y,z){'use strict';z.origin=o;var aa=this,ba=this.findStory(z.attachment);setTimeout(function(){if(ba){var ca=aa.findAttachment(ba);if(ca)z.attachment=ca;}aa.$PubcontentFeedChainingControllerX30(z.attachment,z);},c('AttachmentRelatedShareConstants').EVENT_DELAY);};x.prototype.$PubcontentFeedChainingControllerX18=function(y,z){'use strict';var aa=this,ba=this.findStory(z.attachment);setTimeout(function(){if(ba)var ca=aa.findContainer(ba);aa.$PubcontentFeedChainingControllerX31(ba,z.global_share_id,c('getOrCreateDOMID')(ca));},c('AttachmentRelatedShareConstants').EVENT_DELAY);};x.prototype.$PubcontentFeedChainingControllerX20=function(y,z){'use strict';var aa=this.findStory(z.attachment);if(aa){var ba=this.findAttachment(aa);if(ba)z.attachment=ba;}this.$PubcontentFeedChainingControllerX32(z.attachment,{origin:t,event_id:z.event_id});};x.prototype.$PubcontentFeedChainingControllerX14=function(y,z){'use strict';var aa=this;setTimeout(function(){aa.$PubcontentFeedChainingControllerX33(z.markup.firstChild,{origin:u,content_id:z.content_id});},this.$PubcontentFeedChainingControllerX7.composer_publish_action);};x.prototype.$PubcontentFeedChainingControllerX34=function(y){'use strict';return !!(y&&y.id&&!c('CSS').matchesSelector(y,"._sf6")&&!(y.id in this.$PubcontentFeedChainingControllerX8));};x.prototype.$PubcontentFeedChainingControllerX35=function(y){'use strict';if(!y)return false;if(y.origin in this.$PubcontentFeedChainingControllerX1||y.origin in this.$PubcontentFeedChainingControllerX3||y.origin in this.$PubcontentFeedChainingControllerX2||y.origin in this.$PubcontentFeedChainingControllerX5||y.origin in this.$PubcontentFeedChainingControllerX6||y.origin in this.$PubcontentFeedChainingControllerX7){return true;}else{var z=this.$PubcontentFeedChainingControllerX4[y.origin];if(!z||!z.rate)return false;var aa=Math.random();if(aa>z.rate)return false;return true;}};x.prototype.$PubcontentFeedChainingControllerX36=function(y){'use strict';this.$PubcontentFeedChainingControllerX8[y]=true;};x.prototype.$PubcontentFeedChainingControllerX29=function(y){'use strict';delete this.$PubcontentFeedChainingControllerX8[y];};x.prototype.$PubcontentFeedChainingControllerX23=function(y){'use strict';if(!y)return false;var z="_3lkn",aa=y.nextSibling,ba=true;if(aa&&aa.firstChild){var ca=aa.firstChild;ba=!(ca.hasChildNodes()&&c('CSS').hasClass(ca,z));}if(!ba)return false;var da=y.children[0],ea=y.children[1],fa="_4_ck";if(da&&c('CSS').hasClass(da,fa)||ea&&c('CSS').hasClass(ea,fa))return false;return true;};x.prototype.$PubcontentFeedChainingControllerX24=function(y){'use strict';if(!y)return true;var z=c('DOM').scry(y,"._1xwr");if(z.length)return true;return false;};x.prototype.$PubcontentFeedChainingControllerX28=function(y,z){'use strict';var aa=this.findStory(y);if(!this.$PubcontentFeedChainingControllerX34(aa))return null;if(!this.$PubcontentFeedChainingControllerX35(z))return null;this.$PubcontentFeedChainingControllerX36(aa.id);if(this.isSponsoredStory(aa))return null;var ba;if(!z.continued_chaining){ba=this.findContainer(aa);if(!ba)return null;var ca=c('DOM').create('div'),da=c('DOM').appendContent(ba,ca);if(da.length!==1)return null;}else{ba=aa;ca=c('DOM').create('div');da=c('DOM').insertAfter(ba,ca);c('DOM').remove(ba);if(da.length!==1)return null;}if(z.is_auto_expand){return {chainingWrapper:da[0],story:aa,is_auto_expand:z.is_auto_expand};}else return {chainingWrapper:da[0],story:aa};};x.prototype.$PubcontentFeedChainingControllerX21=function(y,z){'use strict';var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;var ba=this.findStreamRoot(aa.story);if(!ba)return false;var ca=ba.getAttribute('id'),da=c('XFeedAdsChainingController').getURIBuilder().setString('actor_id',z.actor_id).setString('origin',z.origin).setString('ei',z.client_token).setString('data_ownerid',ca);if(z.ft_id)da.setString('ft_id',z.ft_id);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(da.getURI()).send();return true;};x.prototype.$PubcontentFeedChainingControllerX30=function(y,z){'use strict';if(!this.$PubcontentFeedChainingControllerX23(this.findStory(y)))return false;var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;c('CSS').addClass(aa.chainingWrapper,"_3lkn");var ba=null;if(z.fbvideo_id){ba=c('XPubcontentRelatedVideoChainingController').getURIBuilder();ba.setInt('fbvideo_id',z.fbvideo_id);}else{ba=c('XPubcontentRelatedShareChainingController').getURIBuilder();ba.setInt('global_share_id',z.global_share_id);}ba.setString('attachment_div_id',c('getOrCreateDOMID')(z.attachment));if(z.link_url)ba.setString('link_url',z.link_url);if(z.video_div_id)ba.setString('video_div_id',z.video_div_id);if(z.share_id)ba.setString('share_id',z.share_id);var ca=JSON.parse(aa.story.getAttribute('data-ft'))||{};if('qid' in ca&&'mf_story_key' in ca){ba.setString('qid',ca.qid);ba.setString('mf_story_key',ca.mf_story_key);}if(z.is_auto_expand){this.$PubcontentFeedChainingControllerX29(aa.story.id);ba.setBool('is_auto_expand',z.is_auto_expand);}var da=new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(ba.getURI());ca&&da.setData(ca);da.send();return true;};x.prototype.$PubcontentFeedChainingControllerX31=function(y,z,aa){'use strict';if(!this.$PubcontentFeedChainingControllerX34(y))return null;this.$PubcontentFeedChainingControllerX36(y.id);var ba=c('XRelatedGamesChainingController').getURIBuilder().setInt('app_id',z).setString('attachment_div_id',aa);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,y.id)).setURI(ba.getURI()).send();return true;};x.prototype.$PubcontentFeedChainingControllerX22=function(y,z){'use strict';var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;var ba=c('XPubcontentFeedChainingController').getURIBuilder().setString('actor_id',z.actor_id).setString('origin',z.origin);if(z.ft_id)ba.setString('ft_id',z.ft_id);if(z.content_id)ba.setString('content_id',z.content_id);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(ba.getURI()).send();return true;};x.prototype.$PubcontentFeedChainingControllerX25=function(y,z){'use strict';var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;var ba=c('XPubcontentTopicChainingController').getURIBuilder().setIntVector('pivotal_topic_ids',z.pivotal_topic_ids).getURI();new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(ba).send();return true;};x.prototype.$PubcontentFeedChainingControllerX32=function(y,z){'use strict';var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;var ba=c('XEventRelatedEventsPivotController').getURIBuilder().setInt('event_id',z.event_id).setString('attachment_id',c('getOrCreateDOMID')(y)).getURI();new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(ba).send();return true;};x.prototype.$PubcontentFeedChainingControllerX33=function(y,z){'use strict';var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;var ba=c('XSearchRelatedPostsPivotController').getURIBuilder().setString('origin',z.origin).setString('content_id',String(z.content_id));new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(ba.getURI()).setAllowCrossPageTransition(true).send();return true;};x.prototype.$PubcontentFeedChainingControllerX27=function(y,z){'use strict';var aa=this.$PubcontentFeedChainingControllerX28(y,z);if(!aa)return false;var ba=c('XQuickPromotionFeedPivotController').getURIBuilder().setString('action_trigger',String(z.action_trigger));if(z.ft_id)ba.setString('ft_id',z.ft_id);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,aa.story.id)).setRelativeTo(aa.chainingWrapper).setURI(ba.getURI()).setAllowCrossPageTransition(true).send();return true;};x.prototype.findStory=function(y){'use strict';var z="^div._4-u2",aa=c('DOM').scry(y,z);return aa.length===1?aa[0]:null;};x.prototype.isSponsoredStory=function(y){'use strict';var z="._5paw";return c('DOM').scry(y,z).length>0;};x.prototype.findAttachment=function(y){'use strict';var z="div._6m2",aa="div.iframeEmbed",ba=c('DOM').scry(y,z)[0]||c('DOM').scry(y,aa)[0];return ba;};x.prototype.findContainer=function(y){'use strict';var z=c('DOM').create('div'),aa=c('DOM').insertAfter(y,z);c('ContextualThing').register(z,y);return aa.length>=1?aa[0]:null;};x.prototype.findStreamRoot=function(y){'use strict';var z="^div._4ikz";return c('DOM').scry(y,z)[0];};x.prototype.findAdClientToken=function(y){'use strict';var z=this.findStory(y);if(!z)return null;var aa=z.getAttribute('data-ft');if(!aa)return null;var ba=JSON.parse(aa);return ba[x.getAdClientTokenIndex()];};f.exports=x;},null);